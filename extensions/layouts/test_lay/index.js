import{defineComponent as e,toRefs as t,resolveComponent as l,openBlock as a,createElementBlock as o,createVNode as i,unref as r,isRef as n,withCtx as s,createCommentVNode as u,computed as d,ref as c,watch as v}from"vue";import{useSync as m,useStores as g,defineLayout as p,useCollection as y,useItems as f}from"@directus/extensions-sdk";const b={class:"layout-tabular"};var w=e({__name:"layout",props:{collection:{type:String,required:!0},items:{type:Array,required:!0},selection:{type:Array,required:!1,default:()=>[]},tableHeaders:{type:null,required:!0},loading:{type:Boolean,required:!0}},emits:["update:selection","update:tableHeaders","update:limit","update:fields"],setup(e,{emit:d}){const c=e,{collection:v,tableHeaders:p}=t(c),y=m(c,"tableHeaders",d),f=m(c,"selection",d);console.log("<--------------- JK Layout ---------------\x3e"),console.log({tableHeaders:p}),console.log(p.value);const{useCollectionsStore:w}=g();return console.log(g()),console.log(w()),(t,d)=>{const c=l("v-table");return a(),o("div",b,[i(c,{showResize:!0,ref:"table",modelValue:r(f),"onUpdate:modelValue":d[0]||(d[0]=e=>n(f)?f.value=e:null),headers:r(y),loading:e.loading,items:e.items},{default:s((()=>[u(' @click:row="onRowClick" ')])),_:1},8,["modelValue","headers","loading","items"])])}}});function h(e,t,l){return d({get(){var a,o;return null!=(o=null==(a=e.value)?void 0:a[t])?o:r(l)},set(l){e.value=Object.assign({},e.value,{[t]:l})}})}w.__file="src/layout.vue";const H={alias:"raw",bigInteger:"formatted-value",binary:"raw",boolean:"boolean",date:"datetime",dateTime:"datetime",decimal:"formatted-value",float:"formatted-value",integer:"formatted-value",json:"raw",string:"formatted-value",text:"formatted-value",time:"datetime",timestamp:"datetime",uuid:"formatted-value",unknown:"raw",csv:"labels",hash:"formatted-value",geometry:"raw","geometry.Point":"raw","geometry.LineString":"raw","geometry.Polygon":"raw","geometry.MultiPoint":"raw","geometry.MultiLineString":"raw","geometry.MultiPolygon":"raw"};var S=p({id:"test_lay",name:"Test lay",icon:"box",component:w,slots:{options:()=>null,sidebar:()=>null,actions:()=>null},setup(e,{emit:l}){const a=m(e,"layoutQuery",l),o=m(e,"layoutOptions",l),{useFieldsStore:i}=g(),r=i(),{collection:n,filter:s,filterUser:u,search:p}=t(e),{info:b,primaryKeyField:w,fields:S,sortField:k}=y(n),{sort:x,limit:_,page:C,fields:F}=function(){const e=h(a,"page",1),t=h(a,"limit",25),l=d((()=>{var e;return w.value?[null==(e=w.value)?void 0:e.field]:[]})),o=h(a,"sort",l),i=d((()=>S.value.filter((e=>{var t;return!(null==(t=e.meta)?void 0:t.hidden)})).slice(0,4).map((({field:e})=>e)).sort())),r=h(a,"fields",i);return{sort:o,limit:t,page:e,fields:r}}(),q={fields:F,limit:_,sort:x,search:p,filter:s,page:C},{items:P,loading:I,error:M,totalPages:O,itemCount:R,totalCount:j,changeManualSort:z,getItems:K,getItemCount:L,getTotalCount:T}=f(n,q),{tableSort:V,tableHeaders:A,tableRowHeight:J,activeFields:U,tableSpacing:B}=function(){const e=d((()=>{var e,t;return(null==(e=x.value)?void 0:e[0])?(null==(t=x.value)?void 0:t[0].startsWith("-"))?{by:x.value[0].substring(1),desc:!0}:{by:x.value[0],desc:!1}:null})),t=c({});v((()=>o.value),(()=>{t.value={}}));const l=d({get:()=>n.value?F.value.map((e=>({...r.getField(n.value,e),key:e}))).filter((e=>{var t,l;return e&&!0!==(null==(l=null==(t=e.meta)?void 0:t.special)?void 0:l.includes("no-data"))})):[],set(e){F.value=e.map((e=>e.field))}}),a=d({get:()=>l.value.map((e=>{var l,a,i,r,n,s,u,d;return{text:e.name,value:e.key,description:null,width:t.value[e.key]||(null==(a=null==(l=o.value)?void 0:l.widths)?void 0:a[e.key])||null,align:(null==(r=null==(i=o.value)?void 0:i.align)?void 0:r[e.key])||"left",field:{display:(null==(n=e.meta)?void 0:n.display)||(c=e.type,H[c]||"raw"),displayOptions:null==(s=e.meta)?void 0:s.display_options,interface:null==(u=e.meta)?void 0:u.interface,interfaceOptions:null==(d=e.meta)?void 0:d.options,type:e.type,field:e.field,collection:e.collection},sortable:!1===["json","alias","presentation","translations"].includes(e.type)};var c})),set(e){const l={};e.forEach((e=>{e.width&&(l[e.value]=e.width)})),t.value=l,F.value=e.map((e=>e.value))}}),i=h(o,"spacing","cozy"),s=d((()=>{switch(i.value){case"compact":return 32;case"cozy":default:return 48;case"comfortable":return 64}}));return{tableSort:e,tableHeaders:a,tableSpacing:i,tableRowHeight:s,activeFields:l}}();return console.log("<--------------- JK Index ---------------\x3e"),console.log(P),console.log({tableHeaders:A}),{items:P,loading:I,tableHeaders:A}}});export{S as default};
