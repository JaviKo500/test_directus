import{computed as e,defineComponent as t,toRefs as l,resolveComponent as a,openBlock as i,createElementBlock as o,createBlock as r,unref as n,isRef as u,withCtx as s,createElementVNode as d,createCommentVNode as m,toDisplayString as v,createVNode as c,renderSlot as p,ref as y,watch as f}from"vue";import{useStores as g,useSync as h,defineLayout as b,useCollection as w,useItems as k}from"@directus/extensions-sdk";import{useI18n as q}from"vue-i18n";import{useRouter as C}from"vue-router";function S(t,l,a=25){const{useServerStore:i}=g(),{info:{queryLimit:o}}=i();return{sizes:e((()=>{if(void 0===o||-1===o.max)return t.map(l);const e=t.filter((e=>e<=o.max));return 0===e.length&&e.push(o.max),e.map(l)})),selected:void 0!==o?Math.min(a,function(e){if(void 0===e||-1===e)return 1/0;return e}(o.max)):a}}const x={class:"layout-tabular"},P={class:"footer"},F={class:"pagination"},H={key:0,class:"per-page"};var _=t({inheritAttrs:!1,__name:"layout",props:{collection:{type:String,required:!0},items:{type:Array,required:!0},selection:{type:Array,required:!1,default:()=>[]},tableHeaders:{type:null,required:!0},showSelect:{type:null,required:!1,default:"none"},loading:{type:Boolean,required:!0},error:{type:null,required:!1},readonly:{type:Boolean,required:!0},primaryKeyField:{type:null,required:!1},onRowClick:{type:Function,required:!0},itemCount:{type:Number,required:!1,default:void 0},filterUser:{type:null,required:!1,default:void 0},search:{type:String,required:!1,default:void 0},totalPages:{type:Number,required:!0},page:{type:Number,required:!0},toPage:{type:Function,required:!0},limit:{type:Number,required:!0}},emits:["update:selection","update:tableHeaders","update:limit","update:fields"],setup(e,{emit:t}){const y=e,{t:f}=q();l(y);const g=h(y,"tableHeaders",t),b=h(y,"selection",t),w=h(y,"limit",t),{sizes:k,selected:C}=S([25,50,100,250,500,1e3],(e=>String(e)),y.limit);return w.value=C,console.log("<--------------- JK Layout ---------------\x3e"),(t,l)=>{var y;const h=a("v-pagination"),q=a("v-select"),C=a("v-table");return i(),o("div",x,[e.loading||e.itemCount&&e.itemCount>0&&!e.error?(i(),r(C,{key:0,showResize:!0,ref:"table",class:"table","fixed-header":"","show-select":e.showSelect?e.showSelect:void 0!==e.selection,modelValue:n(b),"onUpdate:modelValue":l[1]||(l[1]=e=>u(b)?b.value=e:null),headers:n(g),loading:e.loading,items:e.items,"onClick:row":e.onRowClick,"item-key":null==(y=e.primaryKeyField)?void 0:y.field,"allow-header-reorder":"","selection-use-keys":""},{footer:s((()=>[d("div",P,[d("div",F,[e.totalPages>1?(i(),r(h,{key:0,length:e.totalPages,"total-visible":7,"show-first-last":"","model-value":e.page,"onUpdate:modelValue":e.toPage},null,8,["length","model-value","onUpdate:modelValue"])):m("v-if",!0)]),!1===e.loading&&(e.items.length>=25||e.limit<25)?(i(),o("div",H,[d("span",null,v(n(f)("per_page")),1),c(q,{"model-value":`${e.limit}`,items:n(k),inline:"","onUpdate:modelValue":l[0]||(l[0]=e=>w.value=+e)},null,8,["model-value","items"])])):m("v-if",!0)])])),_:1},8,["show-select","modelValue","headers","loading","items","onClick:row","item-key"])):0===e.itemCount&&(e.filterUser||e.search)?p(t.$slots,"no-items",{key:1}):0===e.itemCount?p(t.$slots,"no-items",{key:2}):m("v-if",!0)])}}});function K(t,l,a){return e({get(){var e,i;return null!=(i=null==(e=t.value)?void 0:e[l])?i:n(a)},set(e){t.value=Object.assign({},t.value,{[l]:e})}})}_.__file="src/layout.vue";const U={alias:"raw",bigInteger:"formatted-value",binary:"raw",boolean:"boolean",date:"datetime",dateTime:"datetime",decimal:"formatted-value",float:"formatted-value",integer:"formatted-value",json:"raw",string:"formatted-value",text:"formatted-value",time:"datetime",timestamp:"datetime",uuid:"formatted-value",unknown:"raw",csv:"labels",hash:"formatted-value",geometry:"raw","geometry.Point":"raw","geometry.LineString":"raw","geometry.Polygon":"raw","geometry.MultiPoint":"raw","geometry.MultiLineString":"raw","geometry.MultiPolygon":"raw"};var R=b({id:"test_lay",name:"Test lay",icon:"box",component:_,slots:{options:()=>null,sidebar:()=>null,actions:()=>null},setup(t,{emit:a}){const i=h(t,"selection",a),o=h(t,"layoutQuery",a),r=h(t,"layoutOptions",a),n=C(),{useFieldsStore:u}=g(),s=u(),{collection:d,filter:m,filterUser:v,search:c}=l(t),{info:p,primaryKeyField:b,fields:q,sortField:S}=w(d),{sort:x,limit:P,page:F,fields:H}=function(){const t=K(o,"page",1),l=K(o,"limit",25),a=e((()=>{var e;return b.value?[null==(e=b.value)?void 0:e.field]:[]})),i=K(o,"sort",a),r=e((()=>q.value.filter((e=>{var t;return!(null==(t=e.meta)?void 0:t.hidden)})).slice(0,4).map((({field:e})=>e)).sort())),n=K(o,"fields",r);return{sort:i,limit:l,page:t,fields:n}}(),_={fields:H,limit:P,sort:x,search:c,filter:m,page:F},{items:R,loading:M,error:V,totalPages:z,itemCount:I,totalCount:$,changeManualSort:L,getItems:N,getItemCount:O,getTotalCount:j}=k(d,_),{tableSort:A,tableHeaders:T,tableRowHeight:B,activeFields:J,tableSpacing:E}=function(){const t=e((()=>{var e,t;return(null==(e=x.value)?void 0:e[0])?(null==(t=x.value)?void 0:t[0].startsWith("-"))?{by:x.value[0].substring(1),desc:!0}:{by:x.value[0],desc:!1}:null})),l=y({});f((()=>r.value),(()=>{l.value={}}));const a=e({get:()=>d.value?H.value.map((e=>({...s.getField(d.value,e),key:e}))).filter((e=>{var t,l;return e&&!0!==(null==(l=null==(t=e.meta)?void 0:t.special)?void 0:l.includes("no-data"))})):[],set(e){H.value=e.map((e=>e.field))}}),i=e({get:()=>a.value.map((e=>{var t,a,i,o,n,u,s,d;return{text:e.name,value:e.key,description:null,width:l.value[e.key]||(null==(a=null==(t=r.value)?void 0:t.widths)?void 0:a[e.key])||null,align:(null==(o=null==(i=r.value)?void 0:i.align)?void 0:o[e.key])||"left",field:{display:(null==(n=e.meta)?void 0:n.display)||(m=e.type,U[m]||"raw"),displayOptions:null==(u=e.meta)?void 0:u.display_options,interface:null==(s=e.meta)?void 0:s.interface,interfaceOptions:null==(d=e.meta)?void 0:d.options,type:e.type,field:e.field,collection:e.collection},sortable:!1===["json","alias","presentation","translations"].includes(e.type)};var m})),set(e){const t={};e.forEach((e=>{e.width&&(t[e.value]=e.width)})),l.value=t,H.value=e.map((e=>e.value))}}),o=K(r,"spacing","cozy"),n=e((()=>{switch(o.value){case"compact":return 32;case"cozy":default:return 48;case"comfortable":return 64}}));return{tableSort:t,tableHeaders:i,tableSpacing:o,tableRowHeight:n,activeFields:a}}();return console.log("<--------------- JK Index ---------------\x3e"),console.log(R),console.log({tableHeaders:T}),{items:R,totalPages:z,page:F,loading:M,error:V,tableHeaders:T,primaryKeyField:b,onRowClick:function({item:e,event:l}){var a,o;if(!0===t.readonly||!b.value)return;const r=e[b.value.field];if(t.selectMode||(null==(a=i.value)?void 0:a.length)>0)!1===(null==(o=i.value)?void 0:o.includes(r))?i.value=i.value.concat(r):i.value=i.value.filter((e=>e!==r));else{const e=n.resolve(`/content/${d.value}/${encodeURIComponent(r)}`);l.ctrlKey||l.metaKey?window.open(e.href,"_blank"):n.push(e)}},itemCount:I,search:c,toPage:function(e){F.value=e},limit:P}}});export{R as default};
